name: MFTPlus Full Courses Scraper

on:
  # Run once per day (02:00 UTC)
  schedule:
     - cron: '0 2 */5 * *'

  # Manual trigger
  workflow_dispatch:

permissions:
  contents: write

jobs:
  scrape:
    runs-on: ubuntu-latest

    steps:
      # ---------------- Checkout repo ----------------
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      # ---------------- Setup Python ----------------
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      # ---------------- Install dependencies ----------------
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 pandas

      # ---------------- Run scraper ----------------
      - name: Run full courses scraper
        run: |
          cd courses-data
          python scrap_full_courses_data.py

      # ---------------- Commit & Push if changed ----------------
      - name: Commit & Push only if changed
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          # Add output files (Ø§Ø³Ù… ÙØ§ÛŒÙ„ JSON Ø®ÙˆØ¯Øª)
          git add courses-data/*.json || true

          # Commit only if there are changes
          if ! git diff --cached --quiet; then
            git commit -m "ğŸ”„ Daily update of MFTPlus courses data [skip ci]"
            git push
          else
            echo "âœ… No changes detected â€“ nothing to commit"
          fi